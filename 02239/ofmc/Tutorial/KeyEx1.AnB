Protocol: KeyEx
# Naive first version without encryption

Types:
  Agent A,B,s;
  Numeric NA,NB;
  Symmetric_key KAB;
  Function sk,h

Knowledge:
  A: A,B,s,sk(A,s),h;
  B: A,B,s,sk(B,s),h;
  s: A,B,s,sk(A,s),sk(B,s),h

Actions:

A->s: A,B,h(NA)
# s creates key KAB
s->A: {|h(NA),h(NB),A,B,KAB|}sk(A,s),{|h(NA),h(NB),A,B,KAB|}sk(B,s)
A->B: A,{|h(NA),h(NB),A,B,KAB|}sk(B,s)

Goals:

A authenticates s on KAB,B
B authenticates s on KAB,A
KAB secret between A,B,s

